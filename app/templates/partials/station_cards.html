<!-- æª¢æŸ¥ç«™ç‹€æ…‹å¡ç‰‡ - Phase 7 æ›´æ–°ï¼šåŠ å…¥å®¹é‡æŒ‡ç¤º -->
<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
    {% for exam_code, station in station_summary.items() %}
    {% set is_broken = exam_code in broken_locations if broken_locations else False %}
    {% set capacity = station.exam.capacity or 5 %}
    {% set utilization = ((station.total / capacity) * 100)|int if capacity > 0 else 0 %}
    
    <div class="bg-white rounded-lg shadow p-3 {% if is_broken %}border-2 border-red-400{% elif utilization >= 100 %}border-2 border-red-300{% elif utilization >= 70 %}border-2 border-yellow-300{% endif %}">
        <div class="flex justify-between items-start mb-2">
            <div>
                <div class="font-bold text-sm">{{ station.exam.name }}</div>
                <div class="text-xs text-gray-500">{{ exam_code }}</div>
            </div>
            {% if is_broken %}
            <span class="text-lg" title="è¨­å‚™æ•…éšœ">ğŸ”´</span>
            {% elif utilization >= 100 %}
            <span class="text-lg" title="å·²æ»¿è¼‰">ğŸ”´</span>
            {% elif utilization >= 70 %}
            <span class="text-lg" title="æ¥è¿‘æ»¿è¼‰">ğŸŸ¡</span>
            {% else %}
            <span class="text-lg" title="æ­£å¸¸">ğŸŸ¢</span>
            {% endif %}
        </div>
        
        <!-- äººæ•¸çµ±è¨ˆ -->
        <div class="grid grid-cols-2 gap-1 text-xs mb-2">
            <div class="flex items-center">
                <span class="text-yellow-500 mr-1">â³</span>
                <span>ç­‰å€™ {{ station.waiting }}</span>
            </div>
            <div class="flex items-center">
                <span class="text-blue-500 mr-1">ğŸ”¬</span>
                <span>æª¢æŸ¥ {{ station.in_exam }}</span>
            </div>
        </div>
        
        <!-- å®¹é‡é€²åº¦æ¢ -->
        <div class="mt-2">
            <div class="flex justify-between text-xs text-gray-500 mb-1">
                <span>å®¹é‡</span>
                <span>{{ station.total }}/{{ capacity }}</span>
            </div>
            <div class="h-1.5 bg-gray-200 rounded-full overflow-hidden">
                <div class="h-full rounded-full transition-all
                    {% if utilization >= 100 %}bg-red-500
                    {% elif utilization >= 70 %}bg-yellow-500
                    {% else %}bg-green-500{% endif %}"
                     style="width: {{ [utilization, 100]|min }}%"></div>
            </div>
        </div>
        
        <!-- ç­‰å€™æ™‚é–“é ä¼° -->
        {% if station.total > 0 %}
        <div class="mt-2 text-xs text-gray-500 text-center">
            â±ï¸ ç´„ {{ station.waiting * station.exam.duration_minutes + (station.in_exam * station.exam.duration_minutes // 2) }} åˆ†é˜
        </div>
        {% endif %}
        
        {% if is_broken %}
        <div class="mt-2 text-xs text-red-600 text-center font-medium">
            âš ï¸ è¨­å‚™æ•…éšœä¸­
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
