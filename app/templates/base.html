<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}é«˜æª¢ç—…äººå‹•æ…‹ç³»çµ±{% endblock %}</title>
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <style>
        /* è‡ªå®šç¾©æ¨£å¼ */
        .loading {
            opacity: 0.5;
            pointer-events: none;
        }
        
        /* æ¨¡æ“¬æ¨¡å¼æ™‚çš„è¦–è¦ºæç¤º */
        {% if is_impersonating %}
        body {
            border: 3px solid #dc2626;
        }
        {% endif %}
    </style>
    
    {% block head %}{% endblock %}
</head>
<body class="bg-gray-100 min-h-screen">
    
    <!-- æ¨¡æ“¬æç¤ºæ¢ -->
    {% if is_impersonating %}
    <div id="impersonate-bar" 
         class="fixed top-0 left-0 right-0 bg-red-600 text-white py-2 px-4 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <span class="text-2xl animate-pulse">ğŸ­</span>
                <div>
                    <span class="font-bold">æ¨¡æ“¬æ¨¡å¼</span>
                    <span class="mx-2">|</span>
                    <span>{{ impersonate_role_name }}</span>
                    <span class="mx-1">-</span>
                    <span class="font-medium">{{ impersonate_user_name }}</span>
                </div>
            </div>
            <form action="/admin/impersonate/end" method="POST" class="inline">
                <button type="submit" 
                        class="bg-white text-red-600 px-4 py-1 rounded font-bold hover:bg-red-100 transition">
                    ğŸ›‘ çµæŸæ¨¡æ“¬
                </button>
            </form>
        </div>
    </div>
    <!-- ä½”ä½ï¼Œé¿å…å…§å®¹è¢«é®ä½ -->
    <div class="h-12"></div>
    {% endif %}
    
    <!-- å°è¦½åˆ— -->
    <nav class="bg-white shadow-sm {% if is_impersonating %}border-b-2 border-red-500{% endif %}">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <a href="/" class="text-xl font-bold text-blue-600">
                    ğŸ¥ é«˜æª¢å‹•æ…‹ç³»çµ±
                </a>
                
                {% if user %}
                <div class="flex items-center space-x-4">
                    <!-- è§’è‰²æ¨™ç±¤ -->
                    {% if user.role == 'admin' %}
                    <span class="px-2 py-1 bg-red-100 text-red-700 rounded text-sm">ç®¡ç†å“¡</span>
                    {% elif user.role == 'dispatcher' %}
                    <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-sm">èª¿åº¦å“¡</span>
                    {% elif user.role == 'coordinator' %}
                    <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-sm">å°ˆå“¡</span>
                    {% elif user.role == 'pending' %}
                    <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-sm">å¾…å¯©æ ¸</span>
                    {% endif %}
                    
                    <!-- ç”¨æˆ¶è³‡è¨Š -->
                    <div class="flex items-center space-x-2">
                        {% if user.picture_url %}
                        <img src="{{ user.picture_url }}" alt="" class="w-8 h-8 rounded-full">
                        {% endif %}
                        <span class="text-gray-700">{{ user.display_name or 'ç”¨æˆ¶' }}</span>
                    </div>
                    
                    <!-- å¿«é€Ÿå°èˆª -->
                    {% if user.role == 'admin' %}
                    <a href="/admin" class="text-gray-500 hover:text-gray-700">ç®¡ç†</a>
                    <a href="/dispatcher" class="text-gray-500 hover:text-gray-700">èª¿åº¦</a>
                    {% elif user.role == 'dispatcher' %}
                    <a href="/dispatcher" class="text-gray-500 hover:text-gray-700">èª¿åº¦å°</a>
                    {% elif user.role == 'coordinator' %}
                    <a href="/coordinator" class="text-gray-500 hover:text-gray-700">æˆ‘çš„ç—…äºº</a>
                    {% endif %}
                    
                    <a href="/auth/logout" class="text-red-500 hover:text-red-700">ç™»å‡º</a>
                </div>
                {% else %}
                <a href="/auth/login" class="text-blue-500 hover:text-blue-700">ç™»å…¥</a>
                {% endif %}
            </div>
        </div>
    </nav>
    
    <!-- ä¸»å…§å®¹ -->
    <main class="max-w-7xl mx-auto px-4 py-6">
        {% block content %}{% endblock %}
    </main>
    
    <!-- é å°¾ -->
    <footer class="bg-white border-t mt-8 py-4">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-500 text-sm">
            å½°æ¿±ç§€å‚³é«˜ç´šå¥æª¢ä¸­å¿ƒ Â© 2024
            {% if is_impersonating %}
            <span class="ml-4 text-red-500">ğŸ­ æ¨¡æ“¬æ¨¡å¼é€²è¡Œä¸­</span>
            {% endif %}
        </div>
    </footer>
    
    {% block scripts %}{% endblock %}
</body>
</html>
