{% extends "base.html" %}

{% block title %}è¨­å‚™ç®¡ç† - é«˜æª¢ç—…äººå‹•æ…‹ç³»çµ±{% endblock %}

{% block content %}
<div class="mb-6 flex justify-between items-center">
    <h1 class="text-2xl font-bold text-gray-800">ğŸ–¥ï¸ è¨­å‚™ç®¡ç†</h1>
    <a href="/admin" class="text-blue-500 hover:underline">â† è¿”å›ç®¡ç†å¾Œå°</a>
</div>

<!-- æ–°å¢è¨­å‚™ -->
<div class="bg-white rounded-xl shadow p-6 mb-6">
    <h2 class="text-lg font-bold text-gray-700 mb-4">æ–°å¢è¨­å‚™</h2>
    <form action="/admin/equipment/add" method="POST" class="flex flex-wrap gap-4 items-end">
        <div>
            <label class="block text-sm text-gray-600 mb-1">è¨­å‚™åç¨±</label>
            <input type="text" name="name" required
                   placeholder="å¦‚: CTæƒæå„€"
                   class="border rounded-lg px-3 py-2 w-48">
        </div>
        <div>
            <label class="block text-sm text-gray-600 mb-1">æ‰€åœ¨æª¢æŸ¥ç«™</label>
            <select name="location" required
                    class="border rounded-lg px-3 py-2 w-40">
                <option value="">é¸æ“‡æª¢æŸ¥ç«™</option>
                {% for exam in exams %}
                <option value="{{ exam.exam_code }}">{{ exam.exam_code }} - {{ exam.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block text-sm text-gray-600 mb-1">è¨­å‚™é¡å‹</label>
            <input type="text" name="equipment_type"
                   placeholder="å¦‚: æª¢æŸ¥è¨­å‚™"
                   class="border rounded-lg px-3 py-2 w-32">
        </div>
        <button type="submit"
                class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium">
            â• æ–°å¢
        </button>
    </form>
</div>

<!-- åˆå§‹åŒ–æŒ‰éˆ• -->
<div class="mb-6">
    <form action="/admin/equipment/init" method="POST" class="inline">
        <button type="submit"
                class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm">
            ğŸš€ ä¾æª¢æŸ¥ç«™åˆå§‹åŒ–è¨­å‚™
        </button>
    </form>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- è¨­å‚™åˆ—è¡¨ -->
    <div class="bg-white rounded-xl shadow overflow-hidden">
        <div class="px-4 py-3 bg-gray-50 border-b font-bold text-gray-700">
            ğŸ“‹ è¨­å‚™åˆ—è¡¨
        </div>
        <div class="divide-y divide-gray-200">
            {% for eq in equipment_list %}
            <div class="px-4 py-3 flex items-center justify-between hover:bg-gray-50">
                <div>
                    <div class="font-medium">{{ eq.name }}</div>
                    <div class="text-sm text-gray-500">
                        ğŸ“ {{ eq.location }} | {{ eq.equipment_type or 'æœªåˆ†é¡' }}
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    {% if eq.status == 'normal' %}
                    <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">ğŸŸ¢ æ­£å¸¸</span>
                    {% elif eq.status == 'warning' %}
                    <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs">ğŸŸ¡ è­¦å‘Š</span>
                    {% elif eq.status == 'broken' %}
                    <span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs">ğŸ”´ æ•…éšœ</span>
                    <form action="/admin/equipment/{{ eq.id }}/repair" method="POST" class="inline">
                        <button type="submit" 
                                class="px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600">
                            âœ… ä¿®å¾©
                        </button>
                    </form>
                    {% endif %}
                    
                    <form action="/admin/equipment/{{ eq.id }}/delete" method="POST" class="inline"
                          onsubmit="return confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è¨­å‚™ï¼Ÿ')">
                        <button type="submit" class="text-red-400 hover:text-red-600 text-sm">
                            ğŸ—‘ï¸
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
            
            {% if not equipment_list %}
            <div class="px-4 py-12 text-center text-gray-500">
                <div class="text-4xl mb-4">ğŸ“­</div>
                <p>å°šç„¡è¨­å‚™</p>
                <p class="text-sm">é»æ“Šä¸Šæ–¹ã€Œåˆå§‹åŒ–è¨­å‚™ã€å»ºç«‹</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- æ“ä½œæ—¥èªŒ -->
    <div class="bg-white rounded-xl shadow overflow-hidden">
        <div class="px-4 py-3 bg-gray-50 border-b font-bold text-gray-700">
            ğŸ“œ æœ€è¿‘æ“ä½œæ—¥èªŒ
        </div>
        <div class="divide-y divide-gray-200 max-h-96 overflow-y-auto">
            {% for log in logs %}
            <div class="px-4 py-3">
                <div class="flex justify-between items-start">
                    <div>
                        <span class="text-sm">
                            {% if log.action == 'report_failure' %}
                            ğŸ”´ æ•…éšœå›å ±
                            {% elif log.action == 'repair' %}
                            âœ… ä¿®å¾©å®Œæˆ
                            {% else %}
                            ğŸ“ {{ log.action }}
                            {% endif %}
                        </span>
                        <span class="text-gray-600">- {{ log.equipment.name if log.equipment else '?' }}</span>
                    </div>
                    <span class="text-xs text-gray-400">
                        {{ log.created_at.strftime('%m/%d %H:%M') }}
                    </span>
                </div>
                {% if log.description %}
                <div class="text-sm text-gray-500 mt-1">{{ log.description }}</div>
                {% endif %}
            </div>
            {% endfor %}
            
            {% if not logs %}
            <div class="px-4 py-8 text-center text-gray-400">
                å°šç„¡æ“ä½œè¨˜éŒ„
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
