{% extends "base.html" %}

{% block title %}çµ±è¨ˆå ±è¡¨ - é«˜æª¢ç—…äººå‹•æ…‹ç³»çµ±{% endblock %}

{% block content %}
<div class="mb-6 flex justify-between items-center">
    <h1 class="text-2xl font-bold text-gray-800">ğŸ“Š çµ±è¨ˆå ±è¡¨</h1>
    <div class="flex items-center space-x-4">
        <form method="GET" class="flex items-center space-x-2">
            <input type="date" name="target_date" value="{{ report_date }}"
                   class="border rounded-lg px-3 py-2"
                   onchange="this.form.submit()">
        </form>
        <a href="/admin/reports/export/daily?target_date={{ report_date }}"
           class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm">
            ğŸ“¥ åŒ¯å‡º CSV
        </a>
    </div>
</div>

<!-- æ—¥æœŸå°èˆª -->
<div class="flex items-center space-x-2 mb-6">
    {% set prev_date = report_date - timedelta(days=1) %}
    {% set next_date = report_date + timedelta(days=1) %}
    <a href="/admin/reports?target_date={{ prev_date.isoformat() }}"
       class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-sm">
        â† å‰ä¸€å¤©
    </a>
    <span class="font-bold text-lg text-blue-600">
        {{ report_date.strftime('%Yå¹´%mæœˆ%dæ—¥') }}
        {% if report_date == today %}
        <span class="text-sm text-green-500">(ä»Šæ—¥)</span>
        {% endif %}
    </span>
    {% if report_date < today %}
    <a href="/admin/reports?target_date={{ next_date.isoformat() }}"
       class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-sm">
        å¾Œä¸€å¤© â†’
    </a>
    {% endif %}
    {% if report_date != today %}
    <a href="/admin/reports" class="px-3 py-1 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded text-sm ml-4">
        å›åˆ°ä»Šæ—¥
    </a>
    {% endif %}
</div>

<!-- æ‘˜è¦çµ±è¨ˆå¡ç‰‡ -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"
     hx-get="/admin/reports/api/summary?target_date={{ report_date }}"
     hx-trigger="every 10s"
     hx-swap="innerHTML">
    {% include "partials/report_summary.html" %}
</div>

<!-- å¿«æ·é€£çµ -->
<div class="flex flex-wrap gap-3 mb-6">
    <a href="/admin/reports/history" 
       class="px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg text-sm">
        ğŸ“œ æ­·å²æŸ¥è©¢
    </a>
    <a href="/admin/reports/trend?days=7"
       class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg text-sm">
        ğŸ“ˆ 7æ—¥è¶¨å‹¢
    </a>
    <a href="/admin/reports/trend?days=30"
       class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg text-sm">
        ğŸ“ˆ 30æ—¥è¶¨å‹¢
    </a>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- æª¢æŸ¥ç«™çµ±è¨ˆ -->
    <div class="bg-white rounded-xl shadow overflow-hidden"
         hx-get="/admin/reports/api/stations?target_date={{ report_date }}"
         hx-trigger="every 10s"
         hx-swap="innerHTML">
        {% include "partials/station_stats.html" %}
    </div>
    
    <!-- å°ˆå“¡çµ±è¨ˆ -->
    <div class="bg-white rounded-xl shadow overflow-hidden"
         hx-get="/admin/reports/api/coordinators?target_date={{ report_date }}"
         hx-trigger="every 10s"
         hx-swap="innerHTML">
        {% include "partials/coordinator_stats.html" %}
    </div>
</div>

<!-- è¿”å›ç®¡ç†å¾Œå° -->
<div class="mt-8">
    <a href="/admin" class="text-blue-500 hover:underline">â† è¿”å›ç®¡ç†å¾Œå°</a>
</div>
{% endblock %}
