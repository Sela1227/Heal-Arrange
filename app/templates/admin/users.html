{% extends "base.html" %}

{% block title %}å¸³è™Ÿç®¡ç† - é«˜æª¢ç—…äººå‹•æ…‹ç³»çµ±{% endblock %}

{% block content %}
<div class="mb-6 flex justify-between items-center">
    <h1 class="text-2xl font-bold text-gray-800">ğŸ‘¥ å¸³è™Ÿç®¡ç†</h1>
    <a href="/admin" class="text-blue-500 hover:text-blue-700">â† è¿”å›å¾Œå°</a>
</div>

<!-- è§’è‰²èªªæ˜ -->
<div class="bg-blue-50 rounded-lg p-4 mb-6">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
        <div>
            <span class="inline-block w-3 h-3 bg-red-500 rounded-full mr-2"></span>
            <strong>admin</strong> - ç®¡ç†å“¡
        </div>
        <div>
            <span class="inline-block w-3 h-3 bg-blue-500 rounded-full mr-2"></span>
            <strong>dispatcher</strong> - èª¿åº¦å“¡
        </div>
        <div>
            <span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-2"></span>
            <strong>coordinator</strong> - å€‹ç®¡å¸«
        </div>
        <div>
            <span class="inline-block w-3 h-3 bg-gray-400 rounded-full mr-2"></span>
            <strong>pending</strong> - å¾…æˆæ¬Š
        </div>
    </div>
</div>

<!-- ç”¨æˆ¶åˆ—è¡¨ -->
<div class="bg-white rounded-xl shadow overflow-hidden">
    <table class="w-full">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç”¨æˆ¶</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">è§’è‰²</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç‹€æ…‹</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">æœ€å¾Œç™»å…¥</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">æ“ä½œ</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
            {% for u in users %}
            <tr class="{% if u.id == user.id %}bg-blue-50{% endif %}">
                <td class="px-6 py-4">
                    <div class="flex items-center">
                        {% if u.picture_url %}
                        <img src="{{ u.picture_url }}" class="w-10 h-10 rounded-full mr-3">
                        {% else %}
                        <div class="w-10 h-10 rounded-full bg-gray-200 mr-3 flex items-center justify-center">
                            ğŸ‘¤
                        </div>
                        {% endif %}
                        <div>
                            <div class="font-medium text-gray-900">{{ u.display_name }}</div>
                            <div class="text-xs text-gray-400">ID: {{ u.id }}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4">
                    {% if u.id == user.id %}
                    <span class="px-2 py-1 text-xs rounded-full 
                        {% if u.role == 'admin' %}bg-red-100 text-red-800
                        {% elif u.role == 'dispatcher' %}bg-blue-100 text-blue-800
                        {% elif u.role == 'coordinator' %}bg-green-100 text-green-800
                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                        {{ u.role }}
                    </span>
                    {% else %}
                    <form action="/admin/users/{{ u.id }}/role" method="POST" class="inline">
                        <select name="role" onchange="this.form.submit()"
                                class="text-sm border rounded px-2 py-1
                                {% if u.role == 'admin' %}border-red-300 bg-red-50
                                {% elif u.role == 'dispatcher' %}border-blue-300 bg-blue-50
                                {% elif u.role == 'coordinator' %}border-green-300 bg-green-50
                                {% else %}border-gray-300 bg-gray-50{% endif %}">
                            {% for role in roles %}
                            <option value="{{ role }}" {% if u.role == role %}selected{% endif %}>
                                {{ role }}
                            </option>
                            {% endfor %}
                        </select>
                    </form>
                    {% endif %}
                </td>
                <td class="px-6 py-4">
                    {% if u.is_active %}
                    <span class="text-green-500">âœ“ å•Ÿç”¨</span>
                    {% else %}
                    <span class="text-red-500">âœ— åœç”¨</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4 text-sm text-gray-500">
                    {% if u.last_login_at %}
                    {{ u.last_login_at.strftime('%m/%d %H:%M') }}
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td class="px-6 py-4">
                    {% if u.id != user.id %}
                    <form action="/admin/users/{{ u.id }}/toggle" method="POST" class="inline">
                        <button type="submit" 
                                class="text-sm {% if u.is_active %}text-red-500 hover:text-red-700{% else %}text-green-500 hover:text-green-700{% endif %}">
                            {% if u.is_active %}åœç”¨{% else %}å•Ÿç”¨{% endif %}
                        </button>
                    </form>
                    {% else %}
                    <span class="text-gray-400 text-sm">ï¼ˆè‡ªå·±ï¼‰</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
