# ğŸ” æ¬Šé™ç³»çµ±å‡ç´šèªªæ˜

## ğŸ“‹ è®Šæ›´æ‘˜è¦

å°‡åŸæœ¬çš„**å–®ä¸€è§’è‰²åˆ¶**æ”¹ç‚º**å¤šæ¬Šé™åˆ¶**ï¼Œä½¿ç”¨è€…å¯ä»¥åŒæ™‚æ“æœ‰å¤šç¨®æ¬Šé™ã€‚

### åŸæœ¬
```
role = "admin"  (åªèƒ½é¸ä¸€ç¨®)
```

### ç¾åœ¨
```python
permissions = ["admin", "dispatcher"]  # å¯åŒæ™‚æ“æœ‰å¤šç¨®æ¬Šé™
```

---

## ğŸ“ ä¿®æ”¹çš„æª”æ¡ˆ

| æª”æ¡ˆ | èªªæ˜ |
|------|------|
| `app/models/user.py` | ä½¿ç”¨è€…æ¨¡å‹ - æ–°å¢ permissions JSON æ¬„ä½ |
| `app/models/__init__.py` | æ¨¡å‹åŒ¯å‡ºæ›´æ–° |
| `app/services/auth.py` | èªè­‰æœå‹™ - æ–°æ¬Šé™æª¢æŸ¥å‡½æ•¸ |
| `app/services/stats.py` | çµ±è¨ˆæœå‹™ - é©é…æ–°æ¬Šé™ç³»çµ± |
| `app/routers/admin.py` | ç®¡ç†å¾Œå° - å¤šæ¬Šé™ç®¡ç† |
| `app/routers/dispatcher.py` | èª¿åº¦å“¡ - æ¬Šé™æª¢æŸ¥æ›´æ–° |
| `app/routers/coordinator.py` | å€‹ç®¡å¸« - æ¬Šé™æª¢æŸ¥æ›´æ–° |
| `app/routers/reports.py` | å ±è¡¨ - æ¬Šé™æª¢æŸ¥æ›´æ–° |
| `app/routers/home.py` | é¦–é  - æ ¹æ“šæ¬Šé™å°èˆª |
| `app/templates/admin/users.html` | å¸³è™Ÿç®¡ç†é é¢ - å¤šæ¬Šé™é¸æ“‡ UI |
| `app/templates/home.html` | åŠŸèƒ½å…¥å£é  - æ ¹æ“šæ¬Šé™é¡¯ç¤º |
| `app/templates/pending.html` | å¾…å¯©æ ¸é é¢ |
| `app/migrations/migrate_permissions.py` | è³‡æ–™åº«é·ç§»è…³æœ¬ |

---

## ğŸ”§ æ¬Šé™å®šç¾©

| æ¬Šé™ | ä»£ç¢¼ | åŠŸèƒ½ |
|------|------|------|
| ç®¡ç†å“¡ | `admin` | å¸³è™Ÿç®¡ç†ã€ç³»çµ±è¨­å®šã€æª¢æŸ¥é …ç›®/è¨­å‚™ç®¡ç† |
| èª¿åº¦å“¡ | `dispatcher` | ç—…äººæŒ‡æ´¾ã€å³æ™‚ç›£æ§ã€å ±è¡¨æŸ¥çœ‹ |
| å€‹ç®¡å¸« | `coordinator` | é™ªåŒç—…äººã€ç‹€æ…‹å›å ± |

### æ¬Šé™çµ„åˆç¯„ä¾‹

| çµ„åˆ | èªªæ˜ |
|------|------|
| `["admin", "dispatcher", "coordinator"]` | è¶…ç´šç®¡ç†å“¡ï¼ˆæ‰€æœ‰åŠŸèƒ½ï¼‰ |
| `["dispatcher", "coordinator"]` | èª¿åº¦å“¡å…¼å€‹ç®¡å¸« |
| `["coordinator"]` | ç´”å€‹ç®¡å¸« |
| `[]` | å¾…å¯©æ ¸ï¼ˆç„¡æ¬Šé™ï¼‰ |

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### 1. æ›´æ–°æª”æ¡ˆ
å°‡ ZIP ä¸­çš„æª”æ¡ˆè¦†è“‹åˆ°å°æ‡‰ä½ç½®ã€‚

### 2. è³‡æ–™åº«é·ç§»
åŸ·è¡Œé·ç§»è…³æœ¬ï¼Œå°‡èˆŠçš„ role è½‰æ›ç‚º permissionsï¼š

```bash
# æ–¹æ³• 1: å‘½ä»¤åˆ—åŸ·è¡Œ
python -m app.migrations.migrate_permissions

# æ–¹æ³• 2: Railway Console åŸ·è¡Œ
from app.migrations.migrate_permissions import run_migration
run_migration()
```

é·ç§»è¦å‰‡ï¼š
- `admin` â†’ `["admin", "dispatcher", "coordinator"]`
- `dispatcher` â†’ `["dispatcher"]`
- `coordinator` â†’ `["coordinator"]`
- `pending` â†’ `[]`

### 3. é‡æ–°éƒ¨ç½²
åœ¨ Railway é‡æ–°éƒ¨ç½²æ‡‰ç”¨ã€‚

---

## ğŸ’¡ æ–°åŠŸèƒ½èªªæ˜

### å¸³è™Ÿç®¡ç†é é¢
- é»æ“Šã€Œâš™ï¸ æ¬Šé™ã€æŒ‰éˆ•é–‹å•Ÿæ¬Šé™è¨­å®š
- å‹¾é¸è¦çµ¦äºˆçš„æ¬Šé™
- æ”¯æ´ã€Œå…¨é¸ã€å’Œã€Œæ¸…é™¤ã€å¿«æ·æ“ä½œ
- ä¸€éµã€Œæ ¸å‡†ã€çµ¦äºˆé è¨­å€‹ç®¡å¸«æ¬Šé™

### é¦–é 
- ç™»å…¥å¾Œé¡¯ç¤ºåŠŸèƒ½å…¥å£é 
- æ ¹æ“šæ¬Šé™é¡¯ç¤ºå¯ç”¨åŠŸèƒ½
- å¾…å¯©æ ¸å¸³è™Ÿé¡¯ç¤ºç­‰å¾…æç¤º

### æ¬Šé™æª¢æŸ¥é‚è¼¯
- ç®¡ç†å“¡è‡ªå‹•æ“æœ‰èª¿åº¦å“¡åŠŸèƒ½
- ç®¡ç†å“¡è‡ªå‹•æ“æœ‰å€‹ç®¡å¸«åŠŸèƒ½
- èª¿åº¦å“¡å’Œå€‹ç®¡å¸«æ¬Šé™ç¨ç«‹

---

## âš ï¸ æ³¨æ„äº‹é …

1. **å‘å¾Œå…¼å®¹**ï¼šä¿ç•™ `role` æ¬„ä½ç”¨æ–¼é¡¯ç¤ºç‹€æ…‹ï¼ˆpending/active/disabledï¼‰
2. **JSON æ¬„ä½**ï¼šPostgreSQL åŸç”Ÿæ”¯æ´ JSON é¡å‹
3. **é·ç§»è…³æœ¬**ï¼šå¯é‡è¤‡åŸ·è¡Œï¼Œå·²é·ç§»çš„è³‡æ–™æœƒè·³é

---

## ğŸ”„ å›æ»¾æ–¹å¼

å¦‚éœ€å›æ»¾åˆ°èˆŠç‰ˆæœ¬ï¼š

```bash
python -m app.migrations.migrate_permissions --rollback
```

é€™æœƒæ ¹æ“š permissions é‚„åŸ role æ¬„ä½ã€‚
